{"version":3,"file":"142.c5bde04dfe86742c.bundle.js","mappings":"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","sources":["webpack://WebComponents/./runestone/webwork/js/webwork.js"],"sourcesContent":["import RunestoneBase from \"../../common/js/runestonebase\";\n\nwindow.wwList = {}; // Multiple Choice dictionary\n\n\nclass WebWork extends RunestoneBase {\n\n    constructor(opts) {\n        super(opts);\n        this.useRunestoneServices = true;\n        this.multipleanswers = false;\n        this.divid = opts.orig.id;\n        this.correct = null;\n        this.optional = false;\n        this.answerList = [];\n        this.correctList = [];\n        this.question = null;\n        this.caption = \"WebWork\";\n        this.containerDiv = opts.orig\n        //this.addCaption(\"runestone\");\n        if (this.divid !== \"fakeww-ww-rs\") {\n            this.checkServer(\"webwork\", true);\n        }\n    }\n\n    restoreAnswers(data) {\n        // Restore answers from storage retrieval done in RunestoneBase\n        // sometimes data.answer can be null\n        if (!data.answer) {\n            data.answer = \"\";\n        }\n        // data.answers comes from postgresql as a JSON column type so no need to parse it.\n        this.answers = data.answer;\n        this.correct = data.correct;\n        this.percent = data.percent;\n        this.decorateStatus();\n    }\n\n    checkLocalStorage() {\n        // Repopulates MCMA questions with a user's previous answers,\n        // which were stored into local storage.\n        var storedData;\n        var answers;\n        if (this.graderactive) {\n            return;\n        }\n        var len = localStorage.length;\n        var ex = localStorage.getItem(this.localStorageKey());\n\n        if (ex !== null) {\n            try {\n                storedData = JSON.parse(ex);\n                answers = storedData.answer.split(\":\");\n            } catch (err) {\n                // error while parsing; likely due to bad value stored in storage\n                console.log(err.message);\n                localStorage.removeItem(this.localStorageKey());\n                return;\n            }\n        }\n    }\n\n    setLocalStorage(data) {\n        var timeStamp = new Date();\n        var storageObj = {\n            answer: data.answer,\n            timestamp: timeStamp,\n            correct: data.correct,\n        };\n        localStorage.setItem(\n            this.localStorageKey(),\n            JSON.stringify(storageObj)\n        );\n    }\n\n\n    // This is called when the runestone_ww_check event is triggered by the webwork problem\n    // Note the webwork problem is in an iframe so we rely on this event and the data\n    // compiled and passed along with the event to \"grade\" the answer.\n    processCurrentAnswers(data) {\n        let correctCount = 0;\n        let qCount = 0;\n        let actString = \"check:\";\n        this.answerObj = {}\n        this.lastAnswerRaw = data;\n        this.answerObj.answers = {};\n        this.answerObj.mqAnswers = {};\n        // data.inputs_\n        for (let k of Object.keys(data.rh_result.answers)) {\n            qCount += 1;\n            if (data.rh_result.answers[k].score == 1) {\n                correctCount += 1;\n            }\n            this.answerObj.answers[k] = `${data.rh_result.answers[k].original_student_ans}`\n            let mqKey = `MaThQuIlL_${k}`;\n            this.answerObj.mqAnswers[mqKey] = data.inputs_ref[mqKey];\n            actString += `actual:${data.rh_result.answers[k].original_student_ans}:expected:${data.rh_result.answers[k].correct_value}:`;\n        }\n        let pct = correctCount / qCount;\n        // If this.percent is set, then runestonebase will transmit it as part of\n        // the logBookEvent API.\n        this.percent = pct;\n        this.actString = actString + `correct:${correctCount}:count:${qCount}:pct:${pct}`;\n        if (pct == 1.0) {\n            this.correct = true;\n        } else {\n            this.correct = false;\n        }\n        this.decorateStatus();\n\n    }\n\n    async logCurrentAnswer(sid) {\n        this.logBookEvent({\n            event: \"webwork\",\n            div_id: this.divid, //todo unmangle problemid\n            act: this.actString,\n            correct: this.correct,\n            answer: JSON.stringify(this.answerObj),\n        });\n\n    }\n\n    checkCurrentAnswer() {\n\n    }\n\n}\n\n\n//\n// These are functions that get called in response to webwork generated events.\n// submitting the work, or showing an answer.\nfunction logWebWork(e, data) {\n    if (eBookConfig.useRunestoneServices) {\n        let wwObj = wwList[data.inputs_ref.problemUUID.replace(\"-ww-rs\",\"\")]\n        if (wwObj) {\n            wwObj.processCurrentAnswers(data);\n            wwObj.logCurrentAnswer();\n        } else {\n            console.log(`Error: Could not find webwork object ${data.inputs_ref.problemUUID}`)\n        }\n    }\n}\n\nfunction logShowCorrect(e, data) {\n    if (eBookConfig.useRunestoneServices) {\n        let wwObj = wwList[data.inputs_ref.problemUUID.replace(\"-ww-rs\",\"\")]\n        if (wwObj) {\n            wwObj.logBookEvent({\n                event: \"webwork\",\n                div_id: data.inputs_ref.problemUUID,\n                act: \"show\",\n            });\n        } else {\n            console.log(`Error: Could not find webwork object ${data.inputs_ref.problemUUID}`)\n        }\n    }\n}\n\nasync function getScores(sid, wwId) {\n\n}\n\nif (typeof window.component_factory === \"undefined\") {\n    window.component_factory = {};\n}\n\nwindow.component_factory.webwork = function(opts) {\n    return new WebWork();\n};\n\n$(function() {\n    $(\"body\").on(\"runestone_ww_check\", logWebWork);\n    $(\"body\").on(\"runestone_show_correct\", logShowCorrect);\n});\n\n\n$(document).on(\"runestone:login-complete\", function () {\n    $(\"[data-component=webwork]\").each(function (index) {\n        // MC\n        var opts = {\n            orig: this,\n            useRunestoneServices: eBookConfig.useRunestoneServices,\n        };\n        if ($(this).closest(\"[data-component=timedAssessment]\").length == 0) {\n            // If this element exists within a timed component, don't render it here\n            window.wwList[this.id] = new WebWork(opts);\n        }\n    });\n});\n"],"names":["window","wwList","WebWork","constructor","opts","super","this","useRunestoneServices","multipleanswers","divid","orig","id","correct","optional","answerList","correctList","question","caption","containerDiv","checkServer","restoreAnswers","data","answer","answers","percent","decorateStatus","checkLocalStorage","graderactive","localStorage","length","ex","getItem","localStorageKey","JSON","parse","split","err","console","log","message","removeItem","setLocalStorage","timeStamp","Date","storageObj","timestamp","setItem","stringify","processCurrentAnswers","correctCount","qCount","actString","answerObj","lastAnswerRaw","mqAnswers","k","Object","keys","rh_result","score","original_student_ans","mqKey","inputs_ref","correct_value","pct","async","sid","logBookEvent","event","div_id","act","checkCurrentAnswer","logWebWork","e","eBookConfig","wwObj","problemUUID","replace","logCurrentAnswer","logShowCorrect","component_factory","webwork","$","on","document","each","index","closest"],"sourceRoot":""}